<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</head>

<body>
    <button onclick="logOut()" class="btn btn-danger m-3">Log out</button>
    <!-- <div id="show"></div> -->
    <div class="col-lg-6 col-10 mx-auto mt-lg-5 mt-3 rounded-3 container-fluid p-lg-5 p-3 shadow-lg">
        <h2 class="text-center">Admin</h2>
        <p id="show"></p>
        <input autofocus type="text" class="form-control shadow-none my-3" placeholder="Product Name..."
            id="product_name">
        <input type="number" class="form-control shadow-none my-3" placeholder="Price..." id="price">
        <input type="number" class="form-control shaow-none my-3" placeholder="Quantity Available..." id="quantity">
        <button class="btn btn-dark w-50 my-3" onclick="uploadProduct()" id="button">Upload Product</button>
    </div>

    <table id="display" class="table my-5"></table>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Product</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control shadow-none my-3" placeholder="Product Name..." id="p_name">
                    <input type="number" class="form-control shadow-none my-3" placeholder="Price..." id="p_price">
                    <input type="number" class="form-control shaow-none my-3" placeholder="Quantity Available..."
                        id="p_quantity">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="edit()" data-bs-dismiss="modal">Save changes</button>
                </div>
            </div>
        </div>
    </div>





    <script>
        window.addEventListener('keydown', (event) => {
            console.log(event);
            if (event.code === "Enter") {
                uploadProduct()
            }
        })


        const signedUser = JSON.parse(localStorage["users"])
        if (signedUser) {
            show.innerHTML = `<h2>Welcome ${signedUser.firstName} ${signedUser.lastName}</h2>`
        } else {
            logOut()
        }

        let editIndex;

        let allProducts = []

        let retrievedArray = localStorage['temuProducts'] ? JSON.parse(localStorage['temuProducts']) : []
        allProducts = retrievedArray

        displayProducts()


        const uploadProduct = () => {
            if (product_name.value.trim() === '' || price === '' || quantity === '') {
                alert("Please fill in all inputs")
            } else {
                const productName = product_name.value.trim()
                const productPrice = price.value.trim()
                const productQuantity = quantity.value.trim()

                const Obj = {
                    productName,
                    productPrice,
                    productQuantity
                }
                console.log(Obj);

                allProducts.push(Obj);
                console.log(allProducts);

                localStorage.temuProducts = JSON.stringify(allProducts)

                displayProducts()

                product_name.value = ''
                price.value = ''
                quantity.value = ''
            }
        }


        const deleteProduct = (index) => {
            const check = confirm("Are you sure you want to delete?");
            if (check === true) {
                allProducts.splice(index, 1)
                localStorage.setItem('temuProducts', JSON.stringify(allProducts));
                displayProducts()
            } else {
                displayProducts()
            }
        }


        const editProduct = (index) => {
            console.log(index);
            editIndex = index;

            p_name.value = allProducts[index].productName
            p_price.value = allProducts[index].productPrice
            p_quantity.value = allProducts[index].productQuantity
        }


        const edit = () => {
            if (p_name.value.trim() === '' || p_price === '' || p_quantity === '') {
                alert("Please fill in all inputs")
            } else {
                const productName2 = p_name.value.trim()
                const productPrice2 = p_price.value.trim()
                const productQuantity2 = p_quantity.value.trim()

                const Obj2 = {
                    productName: productName2,
                    productPrice: productPrice2,
                    productQuantity: productQuantity2
                }
                console.log(Obj2);

                allProducts.splice(editIndex, 1, Obj2)

                localStorage.setItem('temuProducts', JSON.stringify(allProducts));

                displayProducts();
            }
        }


        function displayProducts() {
            if (localStorage['temuProducts'] != undefined) {
                display.innerHTML = `<tr>
                                <th>S/N</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Actions</th>
                            </tr>`
                for (let i = 0; i < allProducts.length; i++) {
                    display.innerHTML += `<tr>
                                    <td>${i + 1}</td>
                                    <td>${allProducts[i].productName}</td>
                                    <td>${allProducts[i].productPrice}</td>
                                    <td>${allProducts[i].productQuantity}</td>
                                    <td><button class="btn btn-danger" onclick="deleteProduct(${i})">Delete</button>&nbsp;<button class="btn btn-warning" onclick="editProduct(${i})" data-bs-toggle="modal" data-bs-target="#exampleModal">Edit</button></td>
                                </tr>`
                }
            } else {
                display.innerHTML = `<h1 class="text-center  my-5">No product added yet</h1>`
            }
        }

        const logOut = () => {
            localStorage.removeItem('users')
            setTimeout(() => {
                window.location.href = 'signup.html'
            }, 2000)
        }
    </script>
</body>

</html>